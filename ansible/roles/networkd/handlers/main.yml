---
- name: Stage minimal DHCP networkd unit for primary NIC
  ansible.builtin.file:
    path: /etc/systemd/network
    state: directory
    owner: root
    group: root
    mode: "0755"
  tags:
    - risky

- name: Remove staged static networkd unit for primary NIC
  ansible.builtin.file:
    path: "/etc/systemd/network/10-{{ net_primary_iface }}.network"
    state: absent
  tags:
    - risky

- name: Write minimal DHCP networkd unit for primary NIC
  ansible.builtin.copy:
    dest: "/etc/systemd/network/05-{{ net_primary_iface }}-dhcp.network"
    owner: root
    group: root
    mode: "0644"
    content: |
      [Match]
      Name={{ net_primary_iface }}

      [Network]
      DHCP=yes
  tags:
    - risky
